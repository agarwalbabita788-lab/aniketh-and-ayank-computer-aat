#include <stdio.h>
#include <stdlib.h>
#include <time.h>

char board[3][3];
char player = 'X', bot = 'O';

void initBoard() {
    for(int i=0;i<3;i++)
        for(int j=0;j<3;j++)
            board[i][j] = ' ';
}

void printBoard() {
    printf("\n");
    for(int i=0;i<3;i++) {
        printf(" %c | %c | %c ", board[i][0], board[i][1], board[i][2]);
        if(i<2) printf("\n---|---|---\n");
    }
    printf("\n\n");
}

int checkWin(char mark) {
    for(int i=0;i<3;i++) {
        if(board[i][0]==mark && board[i][1]==mark && board[i][2]==mark) return 1;
        if(board[0][i]==mark && board[1][i]==mark && board[2][i]==mark) return 1;
    }
    if(board[0][0]==mark && board[1][1]==mark && board[2][2]==mark) return 1;
    if(board[0][2]==mark && board[1][1]==mark && board[2][0]==mark) return 1;
    return 0;
}

int isDraw() {
    for(int i=0;i<3;i++)
        for(int j=0;j<3;j++)
            if(board[i][j]==' ') return 0;
    return 1;
}

void playerMove(char mark) {
    int r,c;
    do {
        printf("Enter row and column (1-3): ");
        scanf("%d %d", &r, &c);
        r--; c--;
    } while(r<0||r>2||c<0||c>2||board[r][c]!=' ');
    board[r][c] = mark;
}

/* EASY BOT: Random Move */
void easyBot() {
    int r,c;
    do {
        r = rand()%3;
        c = rand()%3;
    } while(board[r][c] != ' ');
    board[r][c] = bot;
}

/* MEDIUM BOT: Win or Block */
void mediumBot() {
    for(int i=0;i<3;i++)
        for(int j=0;j<3;j++)
            if(board[i][j]==' ') {
                board[i][j]=bot;
                if(checkWin(bot)) return;
                board[i][j]=' ';
            }

    for(int i=0;i<3;i++)
        for(int j=0;j<3;j++)
            if(board[i][j]==' ') {
                board[i][j]=player;
                if(checkWin(player)) {
                    board[i][j]=bot;
                    return;
                }
                board[i][j]=' ';
            }
    easyBot();
}

/* HARD BOT: Minimax Algorithm */
int minimax(int depth, int isMax) {
    if(checkWin(bot)) return 10-depth;
    if(checkWin(player)) return depth-10;
    if(isDraw()) return 0;

    if(isMax) {
        int best = -1000;
        for(int i=0;i<3;i++)
            for(int j=0;j<3;j++)
                if(board[i][j]==' ') {
                    board[i][j]=bot;
                    int score = minimax(depth+1, 0);
                    board[i][j]=' ';
                    if(score > best) best = score;
                }
        return best;
    } else {
        int best = 1000;
        for(int i=0;i<3;i++)
            for(int j=0;j<3;j++)
                if(board[i][j]==' ') {
                    board[i][j]=player;
                    int score = minimax(depth+1, 1);
                    board[i][j]=' ';
                    if(score < best) best = score;
                }
        return best;
    }
}

void hardBot() {
    int bestScore = -1000, r=0, c=0;
    for(int i=0;i<3;i++)
        for(int j=0;j<3;j++)
            if(board[i][j]==' ') {
                board[i][j]=bot;
                int score = minimax(0, 0);
                board[i][j]=' ';
                if(score > bestScore) {
                    bestScore = score;
                    r=i; c=j;
                }
            }
    board[r][c] = bot;
}

int main() {
    int mode, difficulty;
    srand(time(NULL));

    printf("TIC TAC TOE GAME\n");
    printf("1. Player vs Player\n");
    printf("2. Player vs Bot\n");
    printf("Choose mode: ");
    scanf("%d", &mode);

    if(mode==2) {
        printf("Select Difficulty:\n1. Easy\n2. Medium\n3. Hard\nChoice: ");
        scanf("%d", &difficulty);
    }

    initBoard();

    while(1) {
        printBoard();
        playerMove(player);
        if(checkWin(player)) { printBoard(); printf("Player X wins!\n"); break; }
        if(isDraw()) { printBoard(); printf("Draw!\n"); break; }

        printBoard();
        if(mode==1) {
            playerMove(bot);
        } else {
            if(difficulty==1) easyBot();
            else if(difficulty==2) mediumBot();
            else hardBot();
        }

        if(checkWin(bot)) { printBoard(); printf("Player O wins!\n"); break; }
        if(isDraw()) { printBoard(); printf("Draw!\n"); break; }
    }
    return 0;
}